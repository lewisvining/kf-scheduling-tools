<!DOCTYPE html>
<html>
  <head>
    <title>Engineer Tools</title>
    <style>
      body {
        padding: 20px;
        width: 300px;
        min-height: 300px;
        height: auto; /* Make body fill the viewport */
        display: flex;
        justify-content: center; /* Horizontally center content */
        align-items: center; /* Vertically center content */
        text-align: center; /* Center all text */
        margin: 0;
        flex-direction: column; /* Stack items vertically */
      }
      .k-text{
        font-size: 10px !important;
      }
      .btn-sm{
        --bs-btn-padding-y: 0.15rem !important;
        --bs-btn-font-size: 0.775rem !important;
      }
      #copyNBSIs {
        pointer-events: unset;
      }
      .k-centre{
        text-align: center;
      }
      .text-bg-k{
        background-color: #721ce3;
        color: #fff;
        font-weight: 500 !important;
      }
      .form-check-input {
        transform: scale(0.75);
        margin-top: 0.35rem;
      }
      #regionPostcodeOut, #borderPostcodeOut {
        font-size: 10px;
      }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body>
    <div>
      <div class="mb-2 mt-2 k-centre">
        <span>
          <h4 style="color:#721ce3; display: inline;">KF Scheduling Tools</h4>
          <sup id="versionsup" style="font-size: x-small;"></sup>
        </span>
        <span id="kfstmodepill" class="badge rounded-pill text-bg-k"></span>
        <div class="k-text" id="versionNotice" style="display:none;">
          New version available (<a href="https://github.com/lewisvining/kf-scheduling-tools/releases" target="_blank">download here</a>)
        </div>
        <hr>
        <div id="schedulingpage">
          <div id="schedulingpageM">
            <h6>Inday Contractor Chasing</h6>
            <p class="k-text">Copy engineer names with unattended metering & EV charger appointments</p>
            <div class="btn-group" role="group">
              <button type="button" id="copyEngineerAM" class="btn btn-outline-secondary btn-sm k-text">AM Chase</button>
              <button type="button" id="copyEngineerEV" class="btn btn-outline-primary btn-sm k-text">EV Chase</button>
              <button type="button" id="copyEngineerPM" class="btn btn-outline-secondary btn-sm k-text" >PM Chase</button>
            </div>
            <hr class="d-none">
            <h6 class="d-none">Unattended Appointments</h6>
            <p class="k-text d-none">Copy job references for unattended metering appointments</p>
            <button type="button" id="copyUnattendedRefs_metering" class="btn btn-outline-primary btn-sm k-text d-none">Unattended Chase</button>
            <hr>
          </div>

          <h6>Jeopardy List</h6>
            <p class="k-text">Copy the details of all the jobs currently showing in the scheduling window</p>
            <div class="btn-group" role="group">
              <button type="button" id="copyAllJeop" class="btn btn-outline-primary btn-sm k-text">Copy Full List</button>
              <button type="button" id="copyJeop" data-bs-toggle="modal" data-bs-target="#jeopModal" class="btn btn-outline-primary btn-sm k-text">Custom Selection</button>
            </div>
            <hr>
        </div>
        <!--lookup-->
        <form class="mb-3">
          <label for="accountJobRefLookup" class="form-label k-text">Work Order Quick Lookup</label>
          <div class="mb-3 btn-sm">
            <input type="text" class="form-control k-text" id="accountJobRefLookup">
          </div>
        </form>
        <div id="jobRefLookupBtns" style="display:none;">
          <button type="button" id="openJobBtn" class="btn btn-primary btn-sm k-text">Open Job</button>
          <button type="button" id="searchJeopardyBtn" class="btn btn-outline-primary btn-sm k-text" disabled>Search Jeopardy</button>
        </div>
        <div id="accLookupBtns" class="" style="display:none;">
          <button type="button" id="openAccBtn" class="btn btn-primary btn-sm k-text" disabled>Open Account</button>
          <button type="button" id="searchAccKFBtn" class="btn btn-outline-primary btn-sm k-text" disabled>Search KF</button>
        </div>
        <hr class="">
        <!--lookup end-->
        <div id="" class="container mt-3 k-text">
          <button type="button" data-bs-toggle="modal" data-bs-target="#multiPageCopyModal" class="btn btn-light btn-sm k-text">
            Multi-Page
          </button>
          <button class="btn btn-light btn-sm k-text" data-bs-toggle="modal" data-bs-target="#settingsModal" id="openSettings">
              Settings
          </button>
          <button class="btn btn-light btn-sm k-text" data-bs-toggle="modal" data-bs-target="#regionModal">
            Lookup Tools
          </button>
          <a class="btn btn-outline-primary btn-sm icon-link icon-link-hover k-text" href="https://field.oes-prod.energy/scheduling" id="error" target="_blank" style="display:none;">
            KF Scheduling
            <svg xmlns="http://www.w3.org/2000/svg" class="bi" viewBox="0 0 16 16" aria-hidden="true">  
              <path d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
            </svg>
          </a>
        </div>
        <!-- jeop modal -->
        <div class="modal fade" id="jeopModal" tabindex="-1" aria-labelledby="jeopModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title fs-6" id="multiPageCopyModalLabel">Copy Jeopardy</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body k-text">
                <table class="table table-bordered d-none">
                  <thead>
                    <tr>
                      <th colspan="2" class="text-center">Today's Jeopardy</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <th scope="row">Total</th>
                      <td id="jeopCountALL">Unknown</td>
                    </tr>
                    <tr>
                      <th scope="row">Metering</th>
                      <td id="jeopCountAM">Unknown</td>
                    </tr>
                    <tr>
                      <th scope="row">EV</th>
                      <td id="jeopCountEV">Unknown</td>
                    </tr>
                  </tbody>
                </table>
                <form id="jeopardyForm">
                  <fieldset class="row mb-1 text-start">
                    <legend class="col-form-label col-sm-2 pt-0">Job Types</legend>
                    <div class="col-sm-10">
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="jobtypeMetering" value="jobtypeMetering">
                        <label class="form-check-label" for="jobtypeMetering">
                          Metering
                        </label>
                      </div>
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox"  id="jobtypeEV" value="jobtypeEV">
                        <label class="form-check-label" for="jobtypeEV">
                          EV
                        </label>
                      </div>
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="jobtypeSolar" value="jobtypeSolar">
                        <label class="form-check-label" for="jobtypeSolar">
                          Solar
                        </label>
                      </div>
                      <div class="form-check mb-0">
                        <input class="form-check-input" type="checkbox" id="jobtypeASHP" value="jobtypeASHP">
                        <label class="form-check-label" for="jobtypeASHP">
                          Heat Pumps
                        </label>
                      </div>
                    </div>
                  </fieldset>
                  <div class="mb-2 btn-sm text-start">
                    <label class="form-check-label" for="dateFilter">Date</label>
                    <input type="date" class="form-control btn-sm k-text" id="dateFilter" name="dateFilter" value="2025-08-08" min="2025-07-23" max="2025-09-23" />
                  </div>
                  <div class="mb-2 btn-sm text-start">
                    <label class="form-check-label" for="timeslotFilter">Timeslot</label>
                    <select id="timeslotFilter" class="form-select btn-sm k-text" style="font-size:13px;">
                      <option value="all">All Timeslots</option>
                      <option value="amOnly">AMs Only</option>
                    </select>
                  </div>
                  <div class="mb-2 btn-sm text-start">
                    <label class="form-check-label" for="formatFilter">Format</label>
                    <select id="formatFilter" class="form-select btn-sm k-text" style="font-size:13px;">
                      <option value="default">Jeopardy Sheet (Default formatting)</option>
                      <option value="meteringGSOS">Metering GSOS Sheet</option>
                      <option value="evGSOS">EV GSOS/Future Cancellations Sheet</option>
                      <!-- <option value="evFutureGSOS" disabled>EV Future Cancellations Sheet (Not in use)</option> -->
                    </select>
                  </div>
                </form>
              </div>
              <div id ="" class="modal-footer">
                <button type="button" class="btn btn-light btn-sm k-text" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary btn-sm k-text" id="copyJeopCustom">Copy Jeopardy</button>
              </div>
            </div>
          </div>
        </div>
        <!-- settings modal -->
        <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title fs-6" id="multiPageCopyModalLabel">Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body" style="text-align: centre;">
                    <div class="form-inline">
                      <form style="display:none;">
                        <label for="modeSelect" class="form-label k-text">Product mode</label>
                        <div class="mb-3 btn-sm">
                          <select id="modeSelect" class="form-select k-text">
                              <option value="metering">Metering</option>
                              <option value="ev_chargers">EV Chargers</option>
                          </select>
                        </div>
                      </form>
                      <form>
                        <label for="regionSelect" class="form-label k-text">Filter OES engineers by region</label>
                        <div class="mb-3 btn-sm">
                          <select id="regionSelect" class="form-select btn-sm k-text" style="font-size:13px;">
                            <option value="empty">None</option>
                            <option value="North">North</option>
                            <option value="South">South</option>
                            <option value="East">East</option>
                            <option value="West">West</option>
                            <option value="SE">South East (Volt)</option>
                          </select>
                        </div>
                      </form>
                    </div>
                    <div style="text-align: left;">
                      <form class="form-inline">
                        <b class="k-text">Unattended Chasing</b>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" role="switch" id="utilSheetDataSwitch">
                          <label class="form-check-label k-text" for="flexSwitchCheckDefault">Automatically fill in additional fields for the Utilisation sheet</label>
                        </div>
                        <!-- <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault" disabled>
                          <label class="form-check-label k-text" for="flexSwitchCheckDefault">Exclude NBSIs & on site re-raises</label>
                        </div> -->
                      </form>
                      <!--<form class="form-inline">
                        <b class="k-text">Kraken</b>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                          <label class="form-check-label k-text" for="flexSwitchCheckDefault">Automatically fill in the credit fields on Kraken for GSOS</label>
                        </div>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault2" disabled>
                          <label class="form-check-label k-text" for="flexSwitchCheckDefault2">Enable KF button on Kraken accounts</label>
                        </div>
                      </form>
                      <form class="form-inline">
                        <b class="k-text">Kraken Field</b>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault" disabled>
                          <label class="form-check-label k-text" for="flexSwitchCheckDefault">Enable additional copy buttons on job cards</label>
                        </div>
                      </form>-->
                    </div>
                  </div>
                  <!--<div class="modal-footer">
                      <button type="button" class="btn btn-primary btn-sm" data-bs-dismiss="modal">Ok</button>
                  </div>-->
                </div>
            </div>
        </div>
        <!-- lookup modal -->
        <div class="modal fade" id="regionModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title fs-6" id="multiPageCopyModalLabel">Lookup Tools</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body k-text">
                <form class="mb-3">
                  <label for="regionPostcodeCheck" class="form-label k-text">Postcode lookup</label>
                  <div class="mb-3 btn-sm">
                    <input type="" class="form-control k-text" id="regionPostcodeCheck">
                  </div>
                </form>        
                <span id="regionPostcodeOut" class="badge rounded-pill text-bg-primary mb-3" style="display:none;"></span>
                <span id="borderPostcodeOut" class="badge rounded-pill text-bg-warning mb-3" style="display:none;"></span>
              </div>
            </div>
          </div>
        </div>
         <!-- multipage copy -->
        <div class="modal fade" id="multiPageCopyModal" tabindex="-1" aria-labelledby="multiPageCopyModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content shadow">
              <div class="modal-header">
                <h5 class="modal-title fs-6" id="multiPageCopyModalLabel">Multi-Page Selection</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>

              <div class="modal-body k-text">
                <div id="multiCopyInitial" class="">
                  <p class="mb-3 k-text">
                    Choose which type of engineer appointments to collect across multiple pages. After selecting, the data from this page will be stored. You can continue collecting from additional pages and copy all at once later.
                  </p>

                  <div class="form-check text-start">
                    <input class="form-check-input" type="radio" name="multiCopyRadio" id="multiCopyAM">
                    <label class="form-check-label" for="multiCopyAM">
                      AM Chase (Metering & EV Chargers)
                    </label>
                  </div>
                  <div class="form-check text-start">
                    <input class="form-check-input" type="radio" name="multiCopyRadio" id="multiCopyPM" >
                    <label class="form-check-label" for="multiCopyPM">
                      PM Chase (Metering & EV Chargers)
                    </label>
                  </div>
                  <div class="form-check text-start">
                    <input class="form-check-input" type="radio" name="multiCopyRadio" id="multiCopyEV" >
                    <label class="form-check-label" for="multiCopyEV">
                      EV Charger Chase
                    </label>
                  </div>
                  <div class="form-check text-start">
                    <input class="form-check-input" type="radio" name="multiCopyRadio" id="multiCopyUnattended">
                    <label class="form-check-label" for="multiCopyUnattended">
                      Evening Unattended Metering Jobs
                    </label>
                  </div>

                  <div id="multiCopyFeedback" class="alert alert-info mt-4 d-none" role="alert">
                    <span id="multiCopyCount">0</span> line(s) copied and stored.
                  </div>
                </div>

                <!-- Ongoing Multi-Page Copy View (dynamically injected into .modal-body) -->
                <div id="multiCopyOngoing" class="k-text">
                  <div class="alert alert-info p-2 mb-3">
                    <strong>Multi-Page Chase In Progress</strong><br />
                    <span id="multiCopyRowCount">75</span> line(s) copied from 
                    <span id="multiCopyPageCount">3</span> page(s).<br />
                    <small class="text-muted"><span id="multiCopyType">AM</span></small>
                  </div>
                  

                  <div class="d-grid gap-1">
                    <button id="multiCopyAddPage" class="btn btn-outline-primary btn-sm k-text">
                      Add Current Page to List
                    </button>
                    <button id="multiCopyFinish" class="btn btn-outline-success btn-sm k-text">
                      Finish & Copy Full List
                    </button>
                    <button id="multiCopyCancel" class="btn btn-outline-danger btn-sm k-text">
                      Cancel & Clear List
                    </button>
                  </div>
                </div>
              </div>

              <div id ="multiCopyFooter" class="modal-footer">
                <button type="button" class="btn btn-light btn-sm k-text" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary btn-sm k-text" id="multiCopySubmit">Continue</button>
              </div>
            </div>
          </div>
      </div>
      </div>
    </div>
    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1080">
      <div id="toast-container" class="k-text toast align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
          <div id="toast-content" class="toast-body"></div>
          <!-- <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button> -->
        </div>
      </div>
    </div>
    <script src="bootstrap.bundle.min.js"></script>
    <script src="popup.js"></script>
  </body>
</html>
